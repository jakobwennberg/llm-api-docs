# Ratecardmatcherplugin.Htm

**Source:** https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm  
**Scraped:** 2025-08-01 11:22:36

---

[ ![](https://help.certinia.com/api/resources/images/Logo.png) ](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/Default.htm) Professional Services Automation Apex API Developer Reference |   
---|---  
    * [Home](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/Default.htm)
    * [Getting Started](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [Certinia API](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/GenericAPI.htm)
    * [Actuals](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [APIActualsService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/APIActualsService.htm)
    * [Billing](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [APIBillingService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/APIBillingService.htm)
      * [BillingDocumentService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/BillingDocumentService.htm)
      * [BillingEventsManager](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/BillingEventsManager.htm)
    * [Common](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [APICommonsService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/APICommonsService.htm)
      * [CalendarUtil](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/CalendarUtil.htm)
    * [Exceptions](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [APIException](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/APIException.htm)
    * [Milestones](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [MilestoneService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/MilestoneService.htm)
    * [Miscellaneous](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [MultiCurrencyService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/MultiCurrencyService.htm)
    * [Project Versioning and Baselines](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [VersionConfigService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/VersionConfigService.htm)
      * [VersionService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/VersionService.htm)
    * [Projects and Project Tasks](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [AddFromProjectTemplateService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/AddFromProjectTemplateService.htm)
      * [CreateProjectFromTemplateService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/CreateProjectFromTemplateService.htm)
      * [SObjectCloneMapper](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/SObjectCloneMapper.htm)
      * [TaskManagementService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/TaskManagementService.htm)
    * [Rate Cards](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [RateCardMatcherPlugin](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm)
    * [Resource Management](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [ResourceAssignmentService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/ResourceAssignmentService.htm)
      * [ResourceSearchService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/ResourceSearchService.htm)
      * [ScheduleResourceService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/ScheduleResourceService.htm)
    * [Scheduling](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [AssignmentService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/AssignmentService.htm)
      * [HoursToDaysRuleService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/HoursToDaysRuleService.htm)
      * [ScheduleSaveDTO](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/ScheduleSaveDTO.htm)
      * [ScheduleService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/ScheduleService.htm)
      * [SchedulingStrategyService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/SchedulingStrategyService.htm)
    * [Services Forecasting](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [RevenueForecastScheduler](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RevenueForecastScheduler.htm)
      * [RevenueForecastService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RevenueForecastService.htm)
      * [RevenueForecastVersionScheduler](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RevenueForecastVersionScheduler.htm)
      * [RevenueForecastVersionService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RevenueForecastVersionService.htm)
    * [Shift Management](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [TeamScheduleService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/TeamScheduleService.htm)
      * [TeamScheduleTemplateService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/TeamScheduleTemplateService.htm)
    * [Skills](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [SkillsService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/SkillsService.htm)
    * [Time And Expense](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [PSATimecardService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/PSATimecardService.htm)
    * [Utilization Analytics](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/)
      * [UtilizationAnalyticsService](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/UtilizationAnalyticsService.htm)

|  pse.RateCardMatcherPlugin global with sharing class RateCardMatcherPlugin
  * [IFinalRateCardChoicePlugin](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#IFinalRateCardChoicePlugin)
  * [FinalRateCardChoiceRequest](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#FinalRateCardChoiceRequest)
  * [FinalRateCardChoiceResponse](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#FinalRateCardChoiceResponse)

A class that contains plugins for rate card matching. pse.RateCardMatcherPlugin.IFinalRateCardChoicePlugin global interface IFinalRateCardChoicePlugin Provides an interface that can be used to create plugins to be executed during the matching of rate cards. The plugins customize how the best matching rate cards are chosen. To set up a plugin, create a fferpcore__Plugin__mdt record with a fferpcore__ExtensionPoint__c of RateCardMatcherPlugin.IFinalRateCardChoicePlugin, and a fferpcore__ClassName__c that matches an Apex class that implements that interface.   
If the custom setting (pse__Rate_Card_Settings__c.pse__Disable_Matching__c) is set to true, a plugin will be executed if one is exists but the getRateCardsToChooseFrom method will return an empty set.   

#### Sample Code
```
//Note: This sample code is for demonstration purposes only. It is not intended for
//use in a production environment, is not guaranteed against defects or errors, and
//is in no way optimized or streamlined.

/**
 * This final rate card choice plugin example uses a custom Level field on the Resource Request and Rate Card
 * objects to choose the rate card to match to each resource request. It will only use an exact match for
 * the Level field. It ignores any other records that can have rate cards matched to them such as
 * assignments and project task assignments.
 */
global with sharing class RateCardLevelPlugin implements pse.RateCardMatcherPlugin.IFinalRateCardChoicePlugin {
    global List<pse.RateCardMatcherPlugin.FinalRateCardChoiceResponse> chooseRateCards(
        List<pse.RateCardMatcherPlugin.FinalRateCardChoiceRequest> requests
    ) {
        // Gather the rate cards and resource requests to query for the custom Level field.
        // Custom fields are not included on the rate cards and records passed into the plugin
        // so they must be queried.
        Set<Id> rateCardIds = new Set<Id>();
        Set<Id> resourceRequestIds = new Set<Id>();
        for (pse.RateCardMatcherPlugin.FinalRateCardChoiceRequest request : requests) {
            for (pse__Rate_Card__c rateCard : request.getRateCardsToChooseFrom()) {
                rateCardIds.add(rateCard.Id);
            }

            switch on request.getRecord() {
                when pse__Resource_Request__c resourceRequest {
                    resourceRequestIds.add(resourceRequest.Id);
                }
                when pse__Assignment__c assignment {
                    // Custom rate card matching logic for assignments can be implemented here. In this
                    // plugin implementation, assignments are ignored.
                }
            }
        }

        // Select the custom Level__c fields on both rate card and resource request to use them
        // to find a match.
        Map<Id, pse__Rate_Card__c> rateCardWithLevelById = new Map<Id, pse__Rate_Card__c>(
            [SELECT Id, Level__c FROM pse__Rate_Card__c WHERE Id IN :rateCardIds]
        );
        Map<Id, pse__Resource_Request__c> resourceRequestWithLevelById = new Map<Id, pse__Resource_Request__c>(
            [SELECT Id, Level__c FROM pse__Resource_Request__c WHERE Id IN :resourceRequestIds]
        );

        List<pse.RateCardMatcherPlugin.FinalRateCardChoiceResponse> responses = new List<pse.RateCardMatcherPlugin.FinalRateCardChoiceResponse>();

        for (pse.RateCardMatcherPlugin.FinalRateCardChoiceRequest request : requests) {
            // Add a response to the list for every request so that the response list matches the
            // request list. Responses that do not have a chosen rate card set will not populate
            // the rates on the record.
            pse.RateCardMatcherPlugin.FinalRateCardChoiceResponse response = new pse.RateCardMatcherPlugin.FinalRateCardChoiceResponse();
            responses.add(response);

            switch on request.getRecord() {
                when pse__Resource_Request__c resourceRequest {
                    String resourceRequestLevel = resourceRequestWithLevelById.get(
                            resourceRequest.Id
                        )
                        .Level__c;

                    for (pse__Rate_Card__c rateCard : request.getRateCardsToChooseFrom()) {
                        // All other matching parameters including Start Date, Resource Role,
                        // Account, Region, Practice, and Group have already been applied. The rate
                        // cards to choose from are equally matched according to those parameters.
                        String rateCardLevel = rateCardWithLevelById.get(rateCard.Id).Level__c;

                        if (resourceRequestLevel == rateCardLevel) {
                            // If there is an exact match on the Level field choose the Rate Card.
                            response.setChosenRateCard(rateCard);

                            // Assume there will only be one rate card that matches for each resource request.
                            break;
                        }
                    }
                }
            }
        }

        return responses;
    }
}

```

## Methods
  * [List<FinalRateCardChoiceResponse> chooseRateCards(List<pse.RateCardMatcherPlugin.FinalRateCardChoiceRequest> requests)](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#chooseRateCards0)

chooseRateCards _List <FinalRateCardChoiceResponse> chooseRateCards(List<pse.RateCardMatcherPlugin.FinalRateCardChoiceRequest> requests)_ A method that chooses the best rate card for a record from a set of rate cards.
#### Input Parameters
| Name | Type | Description  
---|---|---  
requests | List<[pse.RateCardMatcherPlugin.FinalRateCardChoiceRequest](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#FinalRateCardChoiceRequest)> | A list of RateCardMatcherPlugin.FinalRateCardChoiceRequest.  
#### Return Value
A list of RateCardMatcherPlugin.FinalRateCardChoiceResponse that parallels the list of requests.
pse.RateCardMatcherPlugin.FinalRateCardChoiceRequest
global with sharing class FinalRateCardChoiceRequest
The request structure for choosing a rate card to match to a record.   

## Methods
  * [global SObject getRecord()](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#getRecord0)
  * [global Set<pse__Rate_Card__c> getRateCardsToChooseFrom()](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#getRateCardsToChooseFrom0)


getRecord
_global SObject getRecord()_
Returns the record that rate cards are being matched to.
#### Return Value
The record to match rate cards to.
getRateCardsToChooseFrom
_global Set <pse__Rate_Card__c> getRateCardsToChooseFrom()_
Returns the set of rate cards to choose from to match to the record.
#### Return Value
The set of rate cards to choose from to match to the record.
pse.RateCardMatcherPlugin.FinalRateCardChoiceResponse
global with sharing class FinalRateCardChoiceResponse
The response structure for choosing a rate card to match to a record.   

## Methods
  * [global FinalRateCardChoiceResponse()](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#FinalRateCardChoiceResponse0)
  * [global void setChosenRateCard(pse__Rate_Card__c chosenRateCard)](https://help.certinia.com/TechnicalReference/2025.1/ProfessionalServicesAutomation/Apex/RateCardMatcherPlugin.htm#setChosenRateCard0)


FinalRateCardChoiceResponse
_global FinalRateCardChoiceResponse()_
setChosenRateCard
_global void setChosenRateCard(pse__Rate_Card__c chosenRateCard)_
Sets the rate card chosen from the set of rate cards provided in the request.
#### Input Parameters
Name | Type | Description  
---|---|---  
chosenRateCard | pse__Rate_Card__c | The rate card chosen from the set of rate cards.  
© Copyright 2009–2025 Certinia Inc. All rights reserved. Various trademarks held by their respective owners. 
